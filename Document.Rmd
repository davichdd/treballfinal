---
output:
  word_document: default
  html_document: default
---
```{r}
library(foreign)
library(knitr)
library(dplyr)
library(tidyverse)
```



Per poder realitzar el nostre estudi, s'ha realitzar una recopilació de dades mitjançant el padró municipal, la estadística municipal de l'atur de l'INE i els resultats electorals al Congrés dels diputats. L'atur s'ha pres a data de novembre de 2019, donat que aquest any es van a dur a terme dues eleccions en pocs mesos, i la situació personal d'atur a aquelles dates podria haver afectat el vot. 

```{r}
datos <-  read.csv("C:/Users/rpuey/Documents/datosfinal.txt")
```

Un cop carregada la nostra taula de dades, és important transformar determinades variables com és la nostra variable depenent, que és el vot a VOX. En aquest cas, el que farem és utilitzar la dada relativa respecte del total de vots a cada municipi, per tal de tenir una aproximació de en quins valors es mou el número de vots de vots de VOX respecte del total. 

Primer de tot creem una variable que serà la suma de tots els vots a cada municipi.

```{r}
names(datos)
datos$totalvotos <- rowSums(datos[ , c(2:14)], na.rm=TRUE)
```
Ara calcularem la taxa de vots de VOX
```{r}
datos$taxaVOX <-datos$VOX/datos$totalvotos
```
Ja podem analitzar les dades de vots a VOX en taxa.
```{r}
summary(datos$taxaVOX)
```
Podem veure que hi han municipis on VOX no va treure cap vot, i el màxim de vots que va treure va ser un 62'5%. La mitjana de vots va ser de 14'4%. És important analitzar la distribució de la variable.

```{r}
distribucióVOX <- hist(datos$taxaVOX)
```
Es pot apreciar una distribució no normal, amb una cua a la dreta important. Això ens dona a pensar que hi han alguns municipis que poden ser uns outliers. S'haurà d'analitzar. 
Un box plot també ens donarà informació sobre els possibles valors extrems.
```{r}
boxplot(datos$taxaVOX, col="blue")
```
Es pot observar que pràcticament a partir del 40% es comencen a observar valors extrems. Per la part inferior no s'observa cap. 

```{r}
qqnorm(datos$taxaVOX)
```
```{r}
plot(density(datos$taxaVOX))
```
Amb la funció density i realitzant un gràfic, es pot veure millor la distribució de la taxa de vot de VOX i com a partir del 40% de vot presenta una distribució no normal. 
```{r}
names(datos)
```
Transformem les diferents variables d'interés en taxes.


```{r}
datos$taxaamericana <- datos$americana/datos$totalpoblacion
datos$taxaasiatica <- datos$asiatica/datos$totalpoblacion
datos$taxaeuropeossinespanyoles <- datos$europeossinespanyoles/datos$totalpoblacion
datos$taxaespanyols <- datos$espaÃ.oles/datos$totalpoblacion
datos$taxatotalunioneuropea <- datos$totalunioneuropea/datos$totalpoblacion
datos$taxaambosexostotalamericana <- datos$ambosexostotalamericana/datos$totalpoblacion
datos$taxatotaloceaniayapatridas <- datos$totaloceaniayapatridas/datos$totalpoblacion
datos$taxatotaloceaniayapatridas <- datos$totaloceaniayapatridas/datos$totalpoblacion
datos$taxaestrangers <- datos$totalextranjeros/datos$totalpoblacion
datos$taxatotalafrica <- datos$totalafrica/datos$totalpoblacion
datos$taxatotalafrica <- datos$totalafrica/datos$totalpoblacion
datos$taxahomesespanyols <- datos$hombresespanyoles/datos$totalpoblacion
datos$taxadonesespanyoles <- datos$mujeresespanyolas/datos$totalpoblacion
```

Ara farem el mateix, però pel sexe.
```{r}
datos$taxahomes <- datos$totalhombres/datos$totalpoblacion
datos$taxadones <- datos$totalmujeres/datos$totalpoblacion
```
També calcularem les taxes pels diferents grups d'edat.

```{r}
datos$taxamenors <- datos$menores/datos$totalpoblacion
datos$taxaedat20_29 <- datos$edad20_29/datos$totalpoblacion
datos$taxaedat30_39 <- datos$edad30_39/datos$totalpoblacion
datos$taxaedat40_49 <- datos$edad40_49/datos$totalpoblacion
datos$taxaedat50_59 <- datos$edad50_59/datos$totalpoblacion
datos$taxaedat60_69 <- datos$edad60_69/datos$totalpoblacion
datos$taxaedat70_79 <- datos$edad70_79/datos$totalpoblacion
datos$taxamajors80 <- datos$mayores80/datos$totalpoblacion
```
Per últim, en aquest tractament de les dades, realitzarem també les taxes dels vots als diferents partits:

```{r}
datos$taxavotPSOE <- datos$PSOE/datos$totalvotos
datos$taxavotsenblanc <- datos$Votosenblanco/datos$totalvotos
datos$taxavotsnuls <- datos$Votosnulos/datos$totalvotos
datos$taxaPP <- datos$PP/datos$totalvotos
datos$taxaCs <- datos$Cs/datos$totalvotos
datos$taxaERC <- datos$ERC/datos$totalvotos
datos$taxaJUNTS <- datos$JUNTS/datos$totalvotos
datos$taxaPODEMOS_IU <- datos$PODEMOS_IU/datos$totalvotos
datos$taxaEH_Bildu <- datos$EH_Bildu/datos$totalvotos
datos$taxaBNG <- datos$BNG/datos$totalvotos
datos$taxaCUP<- datos$CUP/datos$totalvotos
```


Començarem analitzant la variable total estrangers, per veure la seva distribució. Emprarem també la taxa respecte la població total. 
```{r}
summary(datos$taxaestrangers)
```
S'aprecia municipis on no hi ha estrangers, però també s'observen municipios on un 90% de la població són estrangers.

```{r}
distribucioestrangers <- hist(datos$taxaestrangers)
```
```{r}
boxplot(datos$taxaestrangers, col="blue")
```
La distribució d'aquesta variable encara presenta més outliers.Aquests municipis podrien ser aquells que requereixen mà d'obra al camp. 


```{r}
plot(density(datos$taxaestrangers))
```

Amb la densitat de la distribució de la variable, encara s'aprecia més aquesta diferència i com la cua cap a la dreta és força llarga, confirmant aquesta distribució no normal. 

VOX és un partit el qual centra el seu discurs en la immigració de caràcter musulmà i el que ells consideren immigració dolenta. De fet, a una conferència al 2018, Abascal afirmava: “No es lo mismo un inmigrante hispanoamericano que la inmigración de los países islámicos” (https://www.eldiario.es/canariasahora/sociedad/video-abascal-vox-hispanoamericano-inmigracion_1_2166996.html). Per tant, a l'anàlisi de la immigració, ens centrarem d'entrada al total d'estrangers, la taxa africana, americana i asiàtica, ja que també és una font important d'immigració. 
```{r}
summary(datos$taxaamericana)
```
```{r}
hist(datos$taxaamericana)
```

```{r}
boxplot(datos$taxaamericana, col="blue")
```

```{r}
plot(density(datos$taxaamericana))
```
En aquest cas tenim una distribució del 0 al 21%, amb una distribució no normal. S'aprecia una mitjana d'un 1% i una mediana de 0'006.

```{r}
summary(datos$taxaasiatica)
```
```{r}
hist(datos$taxaasiatica)
```
```{r}
boxplot(datos$taxaasiatica, col="blue")
```
```{r}
plot(density(datos$taxaasiatica))
```
En el cas dels asiàtics, la distribució encara és menys normal.
```{r}
summary(datos$taxatotalafrica)
```

```{r}
hist(datos$taxatotalafrica)
```
```{r}
boxplot(datos$taxatotalafrica, col="blue")
```
```{r}
plot(density(datos$taxatotalafrica))
```

També, la taxa d'africans presenta una distribució no normal que va des de 0 a 37'7%.

Per útim, també serà interesant analitzar com es distribueix la taxa d'espanyols, ja que vist com es distribuia la taxa d'estrangers, pot ser que ens trobem alguna distribució diferent.

```{r}
summary(datos$taxaespanyols)
```
```{r}
hist(datos$taxaespanyols)
```
```{r}
boxplot(datos$taxaespanyols, col="blue")
```
```{r}
plot(density(datos$taxaespanyols))
```

Efectivament, en quant a la distribució de la taxa d'espanyols, també trobem que no és normal. En aquest cas la cua va cap a l'esquerra, en contraposició a la taxa d'estrangers. Els outliers també es presenten a la part baixa del boxplot. 


